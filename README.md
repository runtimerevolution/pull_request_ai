# PullRequestAi
Rails Engine that provides the ability to create and open pull requests on GitHub using descriptions generated by ChatGPT.

## Installation
Add this line to your application's Gemfile:

```ruby
gem "pull_request_ai"
```

And then execute:
```bash
$ bundle
```

Or install it yourself as:
```bash
$ gem install pull_request_ai
```

## Contributing
Contribution directions go here.

## License
The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).

### Config

The simplier way to initialize this Gem is by setting the following environment variables:
- [OPENAI_API_KEY](https://platform.openai.com/account/usage)
- [GITHUB_ACCESS_TOKEN](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)

Or you can use the `pull_request_ai.rb` initializer file. Never hardcode secrets into your codebase - instead use something like [dotenv](https://github.com/motdotla/dotenv) to pass the keys safely into your environments.

```ruby
PullRequestAi.configure do |config|
    config.github_access_token = ENV.fetch('GITHUB_ACCESS_TOKEN')
    config.openai_api_key = ENV.fetch('OPENAI_API_KEY')
end
```

If you don't want to automatically open the pull request you can ignore the GitHub access token configuration.

Using the gem initializer you have access to aditional configurations which are set by default with the current values:
```ruby
PullRequestAi.configure do |config|
  ...
  config.openai_api_endpoint = 'https://api.openai.com'
  config.github_api_endpoint = 'https://api.github.com'
  config.model = 'gpt-3.5-turbo'
  config.temperature = 1
end
```

## Usage

To use the UI on the browser you need to mount the engine route into your project routes.
To do that include on your `routes.rb` file the following:
```ruby
mount PullRequestAi::Engine => ''
```

Then you access it at `http://127.0.0.1:3000/rrtools/pull_request_ai`

Or, if you want to use on code you create an instance of the main client object.

```ruby
client = PullRequestAi::Client.new
```

This object offers the following actions:
- current_opened_pull_requests(base) - method that receives a base branch and based on the current branch will return any existing open pull request from GitHub.
- destination_branches - method without arguments that will return a list of all available remote branches.
- open_pull_request(base, title, description) - method that will communicate with the GitHub API to open a new pull request with the given parameters.
- update_pull_request(number, base, title, description) - method to update an existing pull request base, title, and description.
- flatten_current_changes(branch) - method that returns changes between the current branch and the given branch in a single string.

Notes about the return of these methods, all methods take advantage of [dry-monads](https://dry-rb.org/gems/dry-monads/1.3/).